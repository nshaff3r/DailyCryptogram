{% extends "layout.html" %}

{% block cryptogram %}

<div id="inputText" class="text"></div>
<p id="cryptogram" class="text solved">{{ solvedCryptogram }}</p>

{% endblock %}


{% block keyboard %}
<button type="button" class="postbutton" id="left">Share</button>
<button type="button" class="postbutton" id="right">View<br>Stats</button>
<script>
    document.addEventListener("DOMContentLoaded", function(){
        let left = document.getElementById("left");
        let right = document.getElementById("right");
        const dateDashed = {{ dateDashed | tojson }};
        const attempts = {{ attempts | tojson }};
        const status = {{ status | tojson }};
        let num = document.getElementById("num").innerHTML;
        let finished = "";
        var msg = "";
        if (status) {
            finished = "✅";
            msg = `Congratulations on completing Cryptogram ${num}!`;
        } else {
            finished = "💀";
            msg = `Better luck next time!<br>`;
        }
        var userText = document.getElementById('inputText');
        let userWriter = new Typewriter(userText, {
            cursor: '<span style="color: #ffffff;">|</span>',
            delay: 40,
            deleteSpeed: 5
        });
        userWriter.start();
        userWriter.typeString(msg);
        let buttons = [left, right];
        setTimeout(function(){
            for (let i = 0; i < 2; i++)
            {
                buttons[i].style.marginTop = "60px";
                buttons[i].style.opacity = 1;
                buttons[i].addEventListener("mouseover", function(){
                    if (i == 0){buttons[1 - i].style.marginRight = 0;}
                    else{buttons[1 - i].style.marginLeft = 0;}
                    buttons[1 - i].style.opacity = 0;
                    buttons[i].style.width = "300px";
                    buttons[i].style.backgroundColor = "green";
                });
                buttons[i].addEventListener("mouseout", function(){
                    if (i == 1){buttons[1 - i].style.marginLeft = "100px";}
                    else{buttons[1 - i].style.marginRight = "100px";}
                    buttons[1 - i].style.opacity = 1;
                    buttons[i].style.width = "100px";
                    buttons[i].style.backgroundColor = "slategrey";
                });
                buttons[i].addEventListener("click", function(){
                    buttons[1 - i].style.display = "none";
                    buttons[i].classList.add("postfixed"); 
                    if (i == 0) {
                        var copy = `CRYPTOGRAM\n${dateDashed} ${num} ${finished}\nLives Used:\n${"❤️".repeat(attempts)} / 5️⃣\ncryptogramgame.com`
                        navigator.clipboard.writeText(copy)
                            .then(() => {
                                userWriter.stop().pauseFor(1).start().typeString(`<br><br>Copied to keyboard.`); 
                                setTimeout(function(){
                                    userWriter.stop().pauseFor(1).start().deleteChars(20);
                                    buttons[0].classList.remove("postfixed");
                                    buttons[1].style.display = "block";
                                }, 3000)
                            })
                            .catch(error => {
                                var errorString = `<br><br>Error copying to keyboard. Please check your browser permissions and try again.`;
                                userWriter.stop().pauseFor(1).start().typeString(errorString); 
                                setTimeout(function(){
                                    userWriter.stop().pauseFor(1).start().deleteChars(80);
                                    buttons[0].classList.remove("postfixed");
                                    buttons[1].style.display = "block";
                                }, 6500)
                            });
                    }
                    if (i == 1) {
                        userWriter.stop().pauseFor(1).start().deleteChars(50);
                        setTimeout(function(){
                            window.location.href = "/stats";
                            setTimeout(function() {
                                buttons[1].classList.remove("postfixed");
                                buttons[0].style.display = "block";
                            }, 100);
                        }, 1700);
                    }
                })
            }
        }, 2500);
    });
</script>
{% endblock %}