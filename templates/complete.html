{% extends "layout.html" %}

{% block cryptogram %}

<div id="hearts">
    {% for i in range(lives) %}
        <img src="../static//heart.svg" alt="♡" class="life">
    {% endfor %}
</div>

<div id="inputText" class="text"></div>
<div id="status"></div>
<p id="cryptogram" class="text solved">{{ solvedCryptogram }}</p>

{% endblock %}


{% block keyboard %}
<button type="button" class="postbutton" id="left">Share</button>
<button type="button" class="postbutton" id="right">View<br>Stats</button>
<script>
    document.addEventListener("DOMContentLoaded", function(){
        let num = document.getElementById("num").innerHTML
        var userText = document.getElementById('inputText');
        let userWriter = new Typewriter(userText, {
            cursor: '<span style="color: #ffffff;">|</span>',
            delay: 50,
            deleteSpeed: 20
        });
        userWriter.start();
        userWriter.typeString(`Congrats on completing Cryptogram ${num}!`);
        let yes = document.getElementById("left");
        let no = document.getElementById("right");
        const dateDashed = {{ dateDashed | tojson }};
        const attempts = {{ attempts | tojson }};
        let finished = "✅";
        setTimeout(function(){
            let buttons = [yes, no];
            let data = ["yes", "no"];
            for (let i = 0; i < 2; i++)
            {
                buttons[i].style.marginTop = "60px";
                buttons[i].style.opacity = 1;
                buttons[i].addEventListener("mouseover", function(){
                    if (i == 0){buttons[1 - i].style.marginRight = 0;}
                    else{buttons[1 - i].style.marginLeft = 0;}
                    buttons[1 - i].style.opacity = 0;
                    buttons[i].style.width = "300px";
                    buttons[i].style.backgroundColor = "green";
                });
                buttons[i].addEventListener("mouseout", function(){
                    if (i == 1){buttons[1 - i].style.marginLeft = "100px";}
                    else{buttons[1 - i].style.marginRight = "100px";}
                    buttons[1 - i].style.opacity = 1;
                    buttons[i].style.width = "100px";
                    buttons[i].style.backgroundColor = "slategrey";
                });
                buttons[i].addEventListener("click", function(){
                    buttons[1 - i].style.display = "none";
                    buttons[i].classList.add("postfixed"); 
                    if (i == 0) {
                        var copy = `CRYPTOGRAM\n${dateDashed} ${num} ${finished}\nLives Used:\n${"\u2764".repeat(attempts)} / 5️⃣`
                        navigator.clipboard.writeText(copy)
                            .then(() => {
                                userWriter.stop().pauseFor(1).start().typeString(`<br><br>Copied to keyboard.`); 
                                setTimeout(function(){
                                    userWriter.stop().pauseFor(1).start().deleteChars(20);
                                    buttons[0].classList.remove("postfixed");
                                    buttons[1].style.display = "block";
                                }, 4000)
                            })
                            .catch(error => {
                                console.error('Error copying to clipboard:', error);
                            });
                    }
                })
            }
        }, 0);
    });
</script>
{% endblock %}